if {[lsearch [namespace children] ::tcltest] == -1} {
    package require tcltest 2
    namespace import -force ::tcltest::*
}

package require dbus-tcl
dbus connect

test unknown-1.1 {simple define and remove} -body {
    catch {dbus unknown / dummy} rc
} -cleanup {
    catch {dbus method / {}} result
} -result 0

test unknown-1.2 {query all handlers} -setup {
    dbus method / foo dummy
    dbus method /foo bar dummy2
    dbus method "" baz dummy3
    dbus unknown "" dummy4
    dbus unknown / dummy5
    dbus unknown /foo dummy6
} -body {
    dbus unknown
} -cleanup {
    dbus method / foo {}
    dbus method /foo bar {}
    dbus unknown "" {}
    dbus unknown / {}
    dbus unknown /foo {}    
} -result [list "" dummy4 / dummy5 /foo dummy6]

test unknown-1.3 {query handlers for a path} -setup {
    dbus method / foo dummy
    dbus method /foo bar dummy2
    dbus unknown "" dummy3
    dbus unknown / dummy4
    dbus unknown /foo dummy5
} -body {
    dbus unknown /
} -cleanup {
    dbus method / foo {}
    dbus method /foo bar {}
    dbus unknown "" {}
    dbus unknown / {}
    dbus unknown /foo {}    
} -result [list dummy4]

test unknown-1.4 {query default handler} -setup {
    dbus method / foo dummy
    dbus method /foo bar dummy2
    dbus unknown "" dummy3
    dbus unknown / dummy4
    dbus unknown /foo dummy5
} -body {
    dbus unknown ""
} -cleanup {
    dbus method / foo {}
    dbus method /foo bar {}
    dbus unknown "" {}
    dbus unknown / {}
    dbus unknown /foo {}    
} -result [list dummy3]

test unknown-1.5 {query non-existing handler} -body {
    dbus unknown /foo
} -result {}

test unknown-1.6 {query non-existing default handler} -body {
    dbus unknown ""
} -result {}

# cleanup
cleanupTests
return
