#!/usr/bin/tclsh
# -*- mode: Tcl; tab-width: 8; -*-

lappend auto_path [file join [file dirname [info script]] .. lib]

package require keyer

array set data {
    -server default
    -client decode
    -chan 1
    -note 0
}

foreach {option value} $argv {
    switch -- $option {
	--server -
	--client -
	--chan -
	--note {
	    set data([string range $option 1 end]) $value
	}
	default {
	    error "unrecognized option: $option"
	}
    }
}

keyer::decode decode {*}[array get data]

fconfigure stdout -buffering none
while {1} {
    set line [decode gets]
    if {[string length $line]} {
	puts -nonewline $line
    }
}
