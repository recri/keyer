if {[lsearch [namespace children] ::tcltest] == -1} {
    package require tcltest 2
    namespace import -force ::tcltest::*
}

package require dbus-tcl
dbus connect

test release-1.1 {release acquired name} -setup {
    dbus name com.tclcode.test.release
} -body {
    dbus release com.tclcode.test.release
} -result {}

test release-1.2 {release queued request} -setup {
    catch {dbus name com.tclcode.test.noyield}
} -body {
    dbus release com.tclcode.test.noyield
} -result {}

test release-1.3 {release non-queued request} -body {
    dbus release com.tclcode.test.noyield
} -returnCodes error -result {Not owner}

test release-1.4 {release non existing name} -body {
    dbus release com.tclcode.test.dummy
} -returnCodes error -result {Name does not exist}

test release-1.5 {release invalid name} -body {
    dbus release foo
} -returnCodes error -result {Invalid bus name}

# cleanup
cleanupTests
return
