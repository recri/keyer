
<html><head>
<title>dbus - Tcl DBus extension</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.toc,UL.toc UL, UL.toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.section, LI.subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.requirements LI, UL.syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<! -- Generated from file 'doc/dbus.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2008-2013 Schelte Bron
   -->
<! -- CVS: $Id$ dbus.n
   -->
<body><div class="doctools">
<h1 class="title">dbus(n) 2.0 dbus &quot;Tcl DBus extension&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>dbus - Tcl library for interacting with the DBus</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">Event Handlers</a></li>
<li class="section"><a href="#section3">Signatures</a>
<ul>
<li class="subsection"><a href="#subsection1">Variant Arguments</a></li>
</ul>
</li>
<li class="section"><a href="#section4">Slave Interpreters</a></li>
<li class="section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">Tcl 8.5</b></li>
<li>package require <b class="pkgname">dbus 2.0</b></li>
</ul>
<ul class="syntax">
<li><a href="#1"><b class="cmd">dbus</b> <b class="method">call</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-autostart</b> <span class="opt">?<i class="arg">boolean</i>?</span>?</span> <span class="opt">?<b class="option">-dest</b> <i class="arg">target</i>?</span> <span class="opt">?<b class="option">-details</b> <span class="opt">?<i class="arg">boolean</i>?</span>?</span> <span class="opt">?<b class="option">-handler</b> <i class="arg">script</i>?</span> <span class="opt">?<b class="option">-signature</b> <i class="arg">string</i>?</span> <span class="opt">?<b class="option">-timeout</b> <i class="arg">ms</i>?</span> <i class="arg">path</i> <i class="arg">interface</i> <i class="arg">method</i> <span class="opt">?<i class="arg">arg</i> <i class="arg">...</i>?</span></a></li>
<li><a href="#2"><b class="cmd">dbus</b> <b class="method">close</b> <span class="opt">?<i class="arg">busID</i>?</span></a></li>
<li><a href="#3"><b class="cmd">dbus</b> <b class="method">connect</b> <span class="opt">?<i class="arg">address</i>?</span></a></li>
<li><a href="#4"><b class="cmd">dbus</b> <b class="method">error</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-name</b> <i class="arg">string</i>?</span> <i class="arg">destination</i> <i class="arg">serial</i> <span class="opt">?message?</span></a></li>
<li><a href="#5"><b class="cmd">dbus</b> <b class="method">filter</b> <span class="opt">?<i class="arg">busID</i>?</span> <i class="arg">subcommand</i> <b class="option">-option</b> <i class="arg">value</i> <span class="opt">?<i class="arg">...</i>?</span></a></li>
<li><a href="#6"><b class="cmd">dbus</b> <b class="method">info</b> <span class="opt">?<i class="arg">busID</i>?</span> <i class="arg">option</i></a></li>
<li><a href="#7"><b class="cmd">dbus</b> <b class="method">listen</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-details</b>?</span> <span class="opt">?<i class="arg">path</i> <span class="opt">?<i class="arg">member</i> <span class="opt">?<i class="arg">script</i>?</span>?</span>?</span></a></li>
<li><a href="#8"><b class="cmd">dbus</b> <b class="method">method</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-async</b>?</span> <span class="opt">?<b class="option">-details</b>?</span> <span class="opt">?<i class="arg">path</i> <span class="opt">?<i class="arg">member</i> <span class="opt">?<i class="arg">script</i>?</span>?</span>?</span></a></li>
<li><a href="#9"><b class="cmd">dbus</b> <b class="method">monitor</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-details</b>?</span> <i class="arg">script</i></a></li>
<li><a href="#10"><b class="cmd">dbus</b> <b class="method">name</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-option</b> <i class="arg">...</i>?</span> <i class="arg">name</i></a></li>
<li><a href="#11"><b class="cmd">dbus</b> <b class="method">release</b> <span class="opt">?<i class="arg">busID</i>?</span> <i class="arg">name</i></a></li>
<li><a href="#12"><b class="cmd">dbus</b> <b class="method">return</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-signature</b> <i class="arg">string</i>?</span> <i class="arg">destination</i> <i class="arg">serial</i> <span class="opt">?<i class="arg">arg</i> <i class="arg">...</i>?</span></a></li>
<li><a href="#13"><b class="cmd">dbus</b> <b class="method">signal</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-signature</b> <i class="arg">string</i>?</span> <i class="arg">object</i> <i class="arg">interface</i> <i class="arg">name</i> <span class="opt">?<i class="arg">arg</i> <i class="arg">...</i>?</span></a></li>
<li><a href="#14"><b class="cmd">dbus</b> <b class="method">unknown</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-details</b>?</span> <span class="opt">?<i class="arg">path</i> <span class="opt">?<i class="arg">script</i>?</span>?</span></a></li>
<li><a href="#15"><b class="cmd">dbus</b> <b class="method">validate</b> <i class="arg">class</i> <i class="arg">string</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>The <b class="package">dbus</b> package provides commands to interact with DBus
message busses. There are three well-known bus names: <b class="const">session</b>,
<b class="const">system</b>, and <b class="const">starter</b>. The starter bus only applies when the
application has been started as a result of a method call from another
application. A connection to the starter bus will effectively be an
alternative connection to either the session or the system bus.</p>
<p>Most subcommands take a <i class="arg">busID</i> argument. This is the DBus handle as
returned by the <b class="cmd">dbus</b> <b class="method">connect</b> subcommand. For the well-known
busses the handle matches the name of the bus. If the <i class="arg">busID</i> argument
is not specified, it defaults to <b class="const">session</b>.</p>
<dl class="definitions">
<dt><a name="1"><b class="cmd">dbus</b> <b class="method">call</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-autostart</b> <span class="opt">?<i class="arg">boolean</i>?</span>?</span> <span class="opt">?<b class="option">-dest</b> <i class="arg">target</i>?</span> <span class="opt">?<b class="option">-details</b> <span class="opt">?<i class="arg">boolean</i>?</span>?</span> <span class="opt">?<b class="option">-handler</b> <i class="arg">script</i>?</span> <span class="opt">?<b class="option">-signature</b> <i class="arg">string</i>?</span> <span class="opt">?<b class="option">-timeout</b> <i class="arg">ms</i>?</span> <i class="arg">path</i> <i class="arg">interface</i> <i class="arg">method</i> <span class="opt">?<i class="arg">arg</i> <i class="arg">...</i>?</span></a></dt>
<dd><p>Send a method call onto the dbus and optionally wait for a reply.
If the signature of the DBus <b class="const">method_return</b> reply only contains one
top-level element, the arguments of the <b class="const">method_return</b> message are
returned as a single value. More complex structures are returned as a list.</p>
<p>If the response to the DBus <b class="const">method_call</b> message is a DBus
<b class="const">error</b> message, the command will produce an error. In that case the
errorCode variable will be set to <b class="const">DBUS</b> <b class="const">DBUS_MESSAGE_TYPE_ERROR</b>.</p>
<p>The <b class="option">-autostart</b> option specifies whether the bus server should
attempt to start an associated application if the destination name does not
currently exist on the bus. <i class="arg">Boolean</i> may have any proper boolean value,
such as <b class="const">1</b> or <b class="const">no</b>. Defaults to 1 (true).</p>
<p>The <b class="option">-timeout</b> option specifies the maximum time to wait for a
response. A negative timeout indicates that no response should be requested.</p>
<p>If a script is specified with the <b class="option">-handler</b> option, the call will be
asynchronous. In that case the command returns the serial of the request.
The script will be executed when a response comes back or when there is an
error.</p>
<p>The <b class="option">-signature</b> option defines the types of arguments to be sent on
the dbus. See the <span class="sectref"><a href="#section3">Signatures</a></span> section for more information.
If no signature is specified, all arguments will be sent as strings.</p>
<p>The <b class="option">-details</b> option specifies how variant arguments in the return
value are represented. With the default value of FALSE, only the value of a
variant argument is provided. But in some situations the Tcl code may need
to be able to also obtain the argument type. When this option is set to TRUE,
each variant argument is represented as a list with two elements. The first
list element contains the signature of the argument and the second list
element is the value.</p></dd>
<dt><a name="2"><b class="cmd">dbus</b> <b class="method">close</b> <span class="opt">?<i class="arg">busID</i>?</span></a></dt>
<dd><p>Close the connection to the DBus. This will cleanup all handlers, listeners,
and the optional monitor script registered for the <i class="arg">busID</i>. The actual
bus connection of the application will not really be terminated if <i class="arg">busID</i>
is one of the three so-called well-known busses, as this is not supported by
libdbus. Reconnecting to one of those busses will result in reusing the same
unique name as before.</p></dd>
<dt><a name="3"><b class="cmd">dbus</b> <b class="method">connect</b> <span class="opt">?<i class="arg">address</i>?</span></a></dt>
<dd><p>Connect to the DBus. The <i class="arg">address</i> argument specifies the bus to connect
to. This can be either one of the well-known busses ('session', 'system' or
'starter'), or a transport name followed by a colon, and then an optional,
comma-separated list of keys and values in the form key=value.
The command returns a handle that can be used as the <i class="arg">busID</i> argument
in other dbus commands.
It is legal to run this command when already connected.</p></dd>
<dt><a name="4"><b class="cmd">dbus</b> <b class="method">error</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-name</b> <i class="arg">string</i>?</span> <i class="arg">destination</i> <i class="arg">serial</i> <span class="opt">?message?</span></a></dt>
<dd><p>Send a DBus <b class="const">error</b> message with the specified <i class="arg">serial</i> and
<i class="arg">destination</i>. If the <b class="option">-name</b> option is not specified, it
defaults to &quot;org.freedesktop.DBus.Error.Failed&quot;.
This method is targetted to be used in combination with a script registered
using the <b class="method">dbus</b> <b class="method">method</b> subcommand with the <b class="option">-async</b>
option.
The values for <i class="arg">destination</i> and <i class="arg">serial</i> can be obtained from event
information fields 'sender' and 'serial' correspondingly.
See <span class="sectref"><a href="#section2">Event Handlers</a></span> below for more information.</p></dd>
<dt><a name="5"><b class="cmd">dbus</b> <b class="method">filter</b> <span class="opt">?<i class="arg">busID</i>?</span> <i class="arg">subcommand</i> <b class="option">-option</b> <i class="arg">value</i> <span class="opt">?<i class="arg">...</i>?</span></a></dt>
<dd><p>The <b class="method">add</b> subcommand adds a match rule to match messages going through
the message bus. The <b class="method">remove</b> subcommand removes the most recently
added rule that exactly matches the specified option settings. If there is no
matching rule, the command is silently ignored. Available options are:
<b class="option">-destination</b>, <b class="option">-eavesdrop</b>, <b class="option">-interface</b>,
<b class="option">-member</b>, <b class="option">-path</b>, <b class="option">-sender</b>, and <b class="option">-type</b>.
The command returns the match rule passed to libdbus.</p></dd>
<dt><a name="6"><b class="cmd">dbus</b> <b class="method">info</b> <span class="opt">?<i class="arg">busID</i>?</span> <i class="arg">option</i></a></dt>
<dd><p>The info command can be used to obtain information about the DBus.
Available <b class="method">info</b> options are:</p>
<dl class="commands">
<dt><b class="cmd"><b class="method">machineid</b></b></dt>
<dd><p>Get the UUID of the local machine.</p></dd>
<dt><b class="cmd"><b class="method">local</b></b></dt>
<dd><p>The object path used in local/in-process-generated
messages (<b class="const">/org/freedesktop/DBus/Local</b>).</p></dd>
<dt><b class="cmd"><b class="method">name</b></b></dt>
<dd><p>Get the unique name of the connection as assigned by
the message bus.</p></dd>
<dt><b class="cmd"><b class="method">path</b></b></dt>
<dd><p>The object path used to talk to the bus itself
(<b class="const">/org/freedesktop/DBus</b>).</p></dd>
<dt><b class="cmd"><b class="method">pending</b></b></dt>
<dd><p>Report if any messages are in the queue to be sent.</p></dd>
<dt><b class="cmd"><b class="method">serverid</b></b></dt>
<dd><p>Get the UUID of the server we are authenticated to.</p></dd>
<dt><b class="cmd"><b class="method">service</b></b></dt>
<dd><p>The bus name used to talk to the bus itself
(<b class="const">org.freedesktop.DBus</b>).</p></dd>
<dt><b class="cmd"><b class="method">version</b></b></dt>
<dd><p>Returns the version of libdbus.</p></dd>
</dl></dd>
<dt><a name="7"><b class="cmd">dbus</b> <b class="method">listen</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-details</b>?</span> <span class="opt">?<i class="arg">path</i> <span class="opt">?<i class="arg">member</i> <span class="opt">?<i class="arg">script</i>?</span>?</span>?</span></a></dt>
<dd><p>Register a <i class="arg">script</i> to be called when the signal named &quot;<i class="arg">member</i>&quot; at
<i class="arg">path</i> appears on the DBus.
See <span class="sectref"><a href="#section2">Event Handlers</a></span> below for more information.</p>
<p>If the <i class="arg">path</i> argument is an empty string, <i class="arg">script</i> will be executed
whenever a signal message is received for any path, unless a dedicated
listener for the exact path has been defined.
The <i class="arg">member</i> argument may be specified as either a signal name or an
interface and signal name joined by a period. If no interface is specified,
the script will be called for signals with any interface.</p>
<p>If <i class="arg">script</i> is an empty string, the currently registered command for the
specified signal and path will be unregistered.
If the <i class="arg">script</i> argument is not specified, the currently registered
command for the specified signal and path, if any, is returned.
If no <i class="arg">member</i> argument is specified a list of all registered signals
and associated commands at the specified path is returned.
If no <i class="arg">path</i> argument is specified a list of all paths and their
registered signals and associated commands is returned.</p>
<p>The <b class="option">-details</b> option causes variant arguments to be represented as a
list with two elements: The first list element contains the signature of the
argument and the second list element is the value.</p></dd>
<dt><a name="8"><b class="cmd">dbus</b> <b class="method">method</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-async</b>?</span> <span class="opt">?<b class="option">-details</b>?</span> <span class="opt">?<i class="arg">path</i> <span class="opt">?<i class="arg">member</i> <span class="opt">?<i class="arg">script</i>?</span>?</span>?</span></a></dt>
<dd><p>Register a <i class="arg">script</i> to be called when method <i class="arg">member</i> is invoked at
the specified <i class="arg">path</i>.
See <span class="sectref"><a href="#section2">Event Handlers</a></span> below for more information.</p>
<p>If the <i class="arg">path</i> argument is an empty string, <i class="arg">script</i> will be executed
whenever a method call message is received for any path, unless a dedicated
method handler for the exact path has been defined.
The <i class="arg">member</i> argument may be specified as either a method name or an
interface and method name joined by a period. If no interface is specified,
the script will be called for methods with any interface, unless another
handler is specified for the method including the interface.
If <i class="arg">script</i> is an empty string, the currently registered command for the
specified method and path will be unregistered.</p>
<p>When a <i class="arg">script</i> argument is specified, even if it is an empty string,
the command may fail if another interpreter has already registered a handler
for the exact same path, interface and method.
See <span class="sectref"><a href="#section4">Slave Interpreters</a></span> below for more information.</p>
<p>If the <i class="arg">script</i> argument is not specified, the currently registered
command for the specified method and path, if any, is returned. 
If no <i class="arg">member</i> argument is specified a list of all registered methods
and associated commands at the specified path is returned.
If no <i class="arg">path</i> argument is specified a list of all paths and their
registered methods and associated commands is returned.</p>
<p>In the simple case, when <i class="arg">script</i> is evaluated because of a
<b class="const">method_call</b>, the result of the script will be returned to the caller
as a string in a DBus <b class="const">method_return</b> message. If the execution of
<i class="arg">script</i> ends with an error, the error message is returned to the caller
in a DBus <b class="const">error</b> message. Any DBus errors that happen while sending
these messages back to the caller are silently ignored. If the caller
specified the <b class="const">no_reply</b> flag in the <b class="const">method_call</b> as TRUE, no
<b class="const">method_return</b> or <b class="const">error</b> message will be returned.</p>
<p>For more advanced control over the returned messages the <b class="option">-async</b>
option can be specified while registering the script. First of all, as the
name suggests, this option allows results or errors to be returned from code
outside of <i class="arg">script</i>. The <b class="cmd">dbus</b> <b class="method">return</b> and <b class="cmd">dbus</b>
<b class="method">error</b> subcommands should be used for that.
The <b class="cmd">dbus</b> <b class="method">return</b> subcommand can also be used to return more
complex data structures than a string from <i class="arg">script</i>. In that case the
<b class="option">-async</b> option ensures that the return value of <i class="arg">script</i> is
suppressed.
Even when returning a string to the caller from within <i class="arg">script</i> it may
still be useful to specify the <b class="option">-async</b> option and use the <b class="cmd">dbus</b>
<b class="method">return</b> subcommand. This allows handling of dbus errors while
sending back the return message.</p>
<p>When evaluation of <i class="arg">script</i> ends in an error, the error will always be
returned to the caller unless the <b class="const">no_reply</b> flag was set to TRUE. The
setting of the <b class="option">-async</b> option has no influence on this behaviour.</p>
<p>The <b class="option">-details</b> option causes variant arguments to be represented as a
list with two elements: The first list element contains the signature of the
argument and the second list element is the value.</p></dd>
<dt><a name="9"><b class="cmd">dbus</b> <b class="method">monitor</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-details</b>?</span> <i class="arg">script</i></a></dt>
<dd><p>Register a <i class="arg">script</i> to be executed when any DBus message is received.
See <span class="sectref"><a href="#section2">Event Handlers</a></span> below for more information.</p>
<p>This can be useful for building special purpose programs that need to see
all activity on the DBus, for example a DBus monitoring program. 
If <i class="arg">script</i> is an empty string, the currently configured monitor script
will be removed.</p>
<p>The <b class="option">-details</b> option causes variant arguments to be represented as a
list with two elements: The first list element contains the signature of the
argument and the second list element is the value.</p></dd>
<dt><a name="10"><b class="cmd">dbus</b> <b class="method">name</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-option</b> <i class="arg">...</i>?</span> <i class="arg">name</i></a></dt>
<dd><p>Request the bus to assign a given name to the connection. The command will
generate an error in all cases where it was unsuccessful in making the
application the primary owner of the name.</p>
<p>The <b class="option">-yield</b> option specifies that the application will release the
requested name when some other application requests the same name and has
indicated that it wants to take over ownership of the name. The application
will be informed by a signal when it loses ownership of the name.</p>
<p>The <b class="option">-replace</b> option indicates that the application wants to take
over the ownership of the name from the application that is currently the
primary owner, if any. This request will only be honoured if the current
owner has indicated that it will release the name on request.
See also the <b class="option">-yield</b> option.</p>
<p>If the requested name is currently in use and the <b class="option">-replace</b> option
has not been specified, or the <b class="option">-replace</b> option was specified but
the current owner is unwilling to give up its ownership, the name request
will normally be queued. Then when the name is released by current owner it
is assigned to the next requester in the queue and a signal is sent to inform
that requester that it is now the primary owner of the name.
The <b class="option">-noqueue</b> option may be specified to indicate that the name
request should not be queued.</p>
<p>Note that even if the request has been queued, the command will generate an
error because the goal of becoming the primary owner of the name has not
been achieved.</p></dd>
<dt><a name="11"><b class="cmd">dbus</b> <b class="method">release</b> <span class="opt">?<i class="arg">busID</i>?</span> <i class="arg">name</i></a></dt>
<dd><p>Asks the bus to unassign the given name from this connection.</p></dd>
<dt><a name="12"><b class="cmd">dbus</b> <b class="method">return</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-signature</b> <i class="arg">string</i>?</span> <i class="arg">destination</i> <i class="arg">serial</i> <span class="opt">?<i class="arg">arg</i> <i class="arg">...</i>?</span></a></dt>
<dd><p>Send a DBus <b class="const">method_return</b> message with the specified <i class="arg">serial</i> and
<i class="arg">destination</i>. This method is targetted to be used in combination with
a script registered using the <b class="method">dbus</b> <b class="method">method</b> subcommand
with the <b class="option">-async</b> option.
The values for <i class="arg">destination</i> and <i class="arg">serial</i> can be obtained from event
information fields 'sender' and 'serial' correspondingly. 
See <span class="sectref"><a href="#section2">Event Handlers</a></span> below for more information.</p></dd>
<dt><a name="13"><b class="cmd">dbus</b> <b class="method">signal</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-signature</b> <i class="arg">string</i>?</span> <i class="arg">object</i> <i class="arg">interface</i> <i class="arg">name</i> <span class="opt">?<i class="arg">arg</i> <i class="arg">...</i>?</span></a></dt>
<dd><p>Send a signal onto the dbus with the specified type signature. If no
<b class="option">-signature</b> option is provided, all <i class="arg">arg</i>s will be sent as
strings. The command returns the serial number of the dbus message.</p></dd>
<dt><a name="14"><b class="cmd">dbus</b> <b class="method">unknown</b> <span class="opt">?<i class="arg">busID</i>?</span> <span class="opt">?<b class="option">-details</b>?</span> <span class="opt">?<i class="arg">path</i> <span class="opt">?<i class="arg">script</i>?</span>?</span></a></dt>
<dd><p>Register a <i class="arg">script</i> to be called when an unknown method is invoked at
the specified <i class="arg">path</i>.
See <span class="sectref"><a href="#section2">Event Handlers</a></span> below for more information.</p>
<p>If the <i class="arg">path</i> argument is an empty string, <i class="arg">script</i> will be executed
whenever an unknown method call message is received for any path, unless a
dedicated unknown handler for the exact path has been defined.
If <i class="arg">script</i> is an empty string, the currently registered command for the
specified path will be unregistered.</p>
<p>When a <i class="arg">script</i> argument is specified, even if it is an empty string,
the command may fail if another interpreter has already registered an unknown
handler for the exact same path.
See <span class="sectref"><a href="#section4">Slave Interpreters</a></span> below for more information.</p>
<p>If the <i class="arg">script</i> argument is not specified, the currently registered
command for the specified path, if any, is returned. 
If no <i class="arg">path</i> argument is specified, a list of all paths and their
registered unknown handlers is returned.</p>
<p>An unknown handler will usually return an error, but it is also possible to
return a non-error response. The <b class="cmd">dbus</b> <b class="method">error</b> and <b class="cmd">dbus</b>
<b class="method">return</b> subcommands should be used for this purpose.
Contrary to the <b class="cmd">dbus</b> <b class="method">method</b> subcommand, the return value of
the handler will not automatically be returned to the caller.
Any uncaught error in the evaluation of <i class="arg">script</i> will be reported back
to the caller.</p>
<p>The <b class="option">-details</b> option causes variant arguments to be represented as a
list with two elements: The first list element contains the signature of the
argument and the second list element is the value.</p>
<p>It will generally not be necessary to set up unknown handlers. If no unknown
handler is specified, the package returns an
<b class="const">org.freedesktop.dbus.error.unknownmethod</b> error back to the caller of
an unknown method.</p></dd>
<dt><a name="15"><b class="cmd">dbus</b> <b class="method">validate</b> <i class="arg">class</i> <i class="arg">string</i></a></dt>
<dd><p>Validates <i class="arg">string</i> against the rules of the D-Bus specification for
the type of value specified by <i class="arg">class</i>. Returns 1 if validation passes,
otherwise returns 0. The following classes are recognized (the class name
can be abbreviated):</p>
<dl class="definitions">
<dt><b class="const">interface</b></dt>
<dd><p>Two or more dot-separated non-empty elements.
Each element only contains the ASCII characters 
&quot;[A-Z][a-z][0-9]_&quot; and does not begin with a digit.</p></dd>
<dt><b class="const">member</b></dt>
<dd><p>A string that only contains the ASCII characters
&quot;[A-Z][a-z][0-9]_&quot; and does not begin with a digit.</p></dd>
<dt><b class="const">name</b></dt>
<dd><p>Either a unique connection name, or a well-known
connection name. Unique connection names begin with a colon and consist of
at least two dot-separated non-empty elements. Each element only contains
the ASCII characters &quot;[A-Z][a-z][0-9]_&quot;.
Well-known connection names consist of at least two dot-separated
non-empty elements. Each element only contains the ASCII characters
&quot;[A-Z][a-z][0-9]_&quot; and does not begin with a digit.</p></dd>
<dt><b class="const">path</b></dt>
<dd><p>A slash followed by zero or more slash-separated 
non-empty elements. Each element only contains the ASCII characters
&quot;[A-Z][a-z][0-9]_&quot;.</p></dd>
<dt><b class="const">signature</b></dt>
<dd><p>A valid D-Bus message type signature. See
<span class="sectref"><a href="#section3">Signatures</a></span> below for more information on what constitutes a
valid signature.</p></dd>
</dl></dd>
</dl>
</div>
<div id="section2" class="section"><h2><a name="section2">Event Handlers</a></h2>
<p>The <b class="method">call</b>, <b class="method">listen</b>, <b class="method">method</b> and <b class="method">monitor</b>
methods provide the ability to define event handlers. The specified script
will be used as the prefix for a command that will be evaluated whenever
the corresponding DBus event occurs. When the DBus event occurs, a Tcl
command will be generated by concatenating the script with one or more
arguments. The first argument is a dict containing information about the
event. If the DBus event contained any arguments they will be appended to
the command as seperate arguments.</p>
<p>The dict with the event details contains the following information:</p>
<dl class="definitions">
<dt>member</dt>
<dd><p>The interface member being invoked (for methods) or emitted
(for signals).</p></dd>
<dt>interface</dt>
<dd><p>The interface this message is being sent to (for methods)
or being emitted from (for signals). The interface name is fully-qualified.</p></dd>
<dt>path</dt>
<dd><p>The object path this message is being sent to (for methods) or
being emitted from (for signals).</p></dd>
<dt>sender</dt>
<dd><p>The unique name of the connection which originated this message,
or the empty string if unknown or inapplicable. The sender is filled in by
the message bus. Note, the returned sender is always the unique bus name.
Connections may own multiple other bus names, but those are not found in the
sender field.</p></dd>
<dt>destination</dt>
<dd><p>The destination of a message or the empty string if there
is none set.</p></dd>
<dt>messagetype</dt>
<dd><p>The type of a message. Possible values are
<b class="const">method_call</b>, <b class="const">method_return</b>, <b class="const">error</b>, and <b class="const">signal</b>.</p></dd>
<dt>signature</dt>
<dd><p>The type signature of the message, i.e. the type specification
of the arguments in the message payload. See <span class="sectref"><a href="#section3">Signatures</a></span> below for
more information.</p></dd>
<dt>serial</dt>
<dd><p>The serial of a message or 0 if none has been specified. The
message's serial number is provided by the application sending the message
and is used to identify replies to this message. All messages received on a
connection will have a serial provided by the remote application. When
sending messages a serial will automatically be assigned by the dbus
library.</p></dd>
<dt>replyserial</dt>
<dd><p>The serial that the message is a reply to or 0 if none.</p></dd>
<dt>noreply</dt>
<dd><p>Flag indicating if the sender expects a reply. Set to 1 if a
reply is <em>not</em> required.</p></dd>
<dt>autostart</dt>
<dd><p>Flag indicating if the message will cause an owner for
destination name to be auto-started.</p></dd>
<dt>errorname</dt>
<dd><p>The error name of a received error message. An empty string
for all other message types.</p></dd>
</dl>
<p>The event handlers are excuted at global level (outside the context of any
Tcl procedure) in the interpreter in which the event handler was installed.</p>
</div>
<div id="section3" class="section"><h2><a name="section3">Signatures</a></h2>
<p>The DBus specification defines typed arguments. This doesn't fit well with
the Tcl philosophy of <i class="term">everything is a string</i>. To be able to closely
control the type of the arguments to be sent onto the DBus a <b class="const">signature</b>
can be supplied. The signature definition is exactly the same as in the DBus
specification. A signature is a string where a single character or group of
characters specifies the type of an argument. The following types exist:</p>
<dl class="definitions">
<dt>s</dt>
<dd><p>A UTF-8 encoded, nul-terminated Unicode string.</p></dd>
<dt>b</dt>
<dd><p>A boolean, FALSE (0), or TRUE (1).</p></dd>
<dt>y</dt>
<dd><p>A byte (8-bit unsigned integer).</p></dd>
<dt>n</dt>
<dd><p>A 16-bit signed integer.</p></dd>
<dt>q</dt>
<dd><p>A 16-bit unsigned integer.</p></dd>
<dt>i</dt>
<dd><p>A 32-bit signed integer.</p></dd>
<dt>u</dt>
<dd><p>A 32-bit unsigned integer.</p></dd>
<dt>x</dt>
<dd><p>A 64-bit signed integer.</p></dd>
<dt>t</dt>
<dd><p>A 64-bit unsigned integer.</p></dd>
<dt>d</dt>
<dd><p>An 8-byte double in IEEE 754 format.</p></dd>
<dt>g</dt>
<dd><p>A type signature.</p></dd>
<dt>o</dt>
<dd><p>An object path.</p></dd>
<dt>a#</dt>
<dd><p>A D-Bus array type, which is similar to a Tcl list. The # specifies
the type of the array elements. This can be any type, including another
array, a struct or a dict entry.</p></dd>
<dt>v</dt>
<dd><p>A D-Bus variant type. The provided value should be a two-element list,
containing a signature and the actual value. See <span class="sectref"><a href="#subsection1">Variant Arguments</a></span>
for more information.</p></dd>
<dt>(...)</dt>
<dd><p>A struct. The string inside the parentheses defines the types of
the arguments within the struct, which may consist of a combination of any
of the existing types.</p></dd>
<dt>{##}</dt>
<dd><p>A dict entry. Dict entries may only occur as array elements. The
first # specifies the type of the dict key. This must be a basic type
(one of 'sbynqiuxtdgo'). The second # specifies the type of the dict value.
This can again be any existing type.</p></dd>
</dl>
<p><em>Example</em>: The signature 'vaas(id)a{i(ss)}' specifies four arguments and
translates to Tcl terminology as follows: The type of the first argument
('v') is extracted from its value. The second argument ('aas') is a list
containing lists of strings. The third argument ('(id)') is a list containing
an integer and a double. The last argument ('a{i(ss)}') is a dict (an array
of dict entries) with integer keys and each value is a list of two strings.</p>
<div id="subsection1" class="subsection"><h3><a name="subsection1">Variant Arguments</a></h3>
<p>When a signature specifies that an argument is of type &quot;variant&quot;, the
argument can still be almost anything. Additional information needs to be
located to determine how to package the value for transmission onto the
dbus. The preferred way is for the argument to be a two-element list where
the first element specifies the signature for the value and the second
element is the actual value.</p>
<p>The signature for a variant argument has to specify a single complete type.
The value of the second list element must match the signature, otherwise an
error will be reported.</p>
<p>If the value provided for a variant argument is not a two-element list, or
the first element is not a valid signature for a single complete type, the
code will attempt to automatically determine the type of the provided value.
It does this by selecting a signature based on the internal representation
of the value according to the following table:</p>
<dl class="definitions">
<dt>string: s</dt>
<dd></dd>
<dt>int: i</dt>
<dd></dd>
<dt>wideInt: x</dt>
<dd></dd>
<dt>double: d</dt>
<dd></dd>
<dt>boolean: b</dt>
<dd></dd>
<dt>list: as</dt>
<dd></dd>
<dt>dict: a{ss}</dt>
<dd></dd>
<dt>anything else: s</dt>
<dd></dd>
</dl>
</div>
</div>
<div id="section4" class="section"><h2><a name="section4">Slave Interpreters</a></h2>
<p>The standard D-Bus library <b class="const">libdbus</b> will only assign a single unique
bus name per application. This means that slave interpreters that connect to
the D-Bus will get the same unique bus name as the main interpreter, or any
other slave interpreter that has connected to the D-Bus.</p>
<p>It is not a problem if multiple interpreters register a listener for the
exact same signal. The <b class="package">dbus</b> package will execute the
commands for all interpreters (in an undefined order). The same applies to
monitor commands registered by different interpreters. However, a method
call generally causes a result being returned to the caller. Therefor there
should only be exactly one handler registered for a specific method. If any
interpreter tries to register a method handler for an interface and member
at a path that is already registered by another interpreter, the request
will be denied.</p>
</div>
<div id="copyright" class="section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2008-2013 Schelte Bron</p>
</div>
</div></body></html>
