
<html><head>
<title>dbif - Tcl D-Bus Interface</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.toc,UL.toc UL, UL.toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.section, LI.subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.requirements LI, UL.syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<! -- Generated from file 'doc/dbif.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2008-2013 Schelte Bron
   -->
<! -- CVS: $Id$ dbif.n
   -->
<body><div class="doctools">
<h1 class="title">dbif(n) 1.0 dbif &quot;Tcl D-Bus Interface&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>dbif - Application layer around the Tcl D-Bus library</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">VALID NAMES</a></li>
<li class="section"><a href="#section3">ARGUMENT LISTS</a></li>
<li class="section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">Tcl 8.5</b></li>
<li>package require <b class="pkgname">dbus 2.0</b></li>
<li>package require <b class="pkgname">dbif 1.0</b></li>
</ul>
<ul class="syntax">
<li><a href="#1"><b class="cmd">dbif</b> <b class="method">connect</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-noqueue</b>?</span> <span class="opt">?<b class="option">-replace</b>?</span> <span class="opt">?<b class="option">-yield</b>?</span> <span class="opt">?<i class="arg">name</i> ...?</span></a></li>
<li><a href="#2"><b class="cmd">dbif</b> <b class="method">default</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span></a></li>
<li><a href="#3"><b class="cmd">dbif</b> <b class="method">delete</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i></a></li>
<li><a href="#4"><b class="cmd">dbif</b> <b class="method">error</b> <i class="arg">messageID</i> <i class="arg">errormessage</i> <span class="opt">?<i class="arg">errorname</i>?</span></a></li>
<li><a href="#5"><b class="cmd">dbif</b> <b class="method">generate</b> <i class="arg">signalID</i> <span class="opt">?<i class="arg">arg</i> ...?</span></a></li>
<li><a href="#6"><b class="cmd">dbif</b> <b class="method">get</b> <i class="arg">messageID</i> <i class="arg">name</i></a></li>
<li><a href="#7"><b class="cmd">dbif</b> <b class="method">listen</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i> <span class="opt">?<i class="arg">arglist</i>?</span> <span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">body</i></a></li>
<li><a href="#8"><b class="cmd">dbif</b> <b class="method">method</b> <span class="opt">?<b class="option">-async</b>?</span> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i> <span class="opt">?<i class="arg">inputargs</i> <span class="opt">?<i class="arg">outputargs</i>?</span>?</span> <span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">body</i></a></li>
<li><a href="#9"><b class="cmd">dbif</b> <b class="method">property</b> <span class="opt">?<b class="option">-access</b> <i class="arg">mode</i>?</span> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i>?:<i class="arg">signature</i>? <i class="arg">variable</i> <span class="opt">?<span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">body</i>?</span></a></li>
<li><a href="#10"><b class="cmd">dbif</b> <b class="method">return</b> <i class="arg">messageID</i> <i class="arg">returnvalue</i></a></li>
<li><a href="#11"><b class="cmd">dbif</b> <b class="method">signal</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i> <span class="opt">?<i class="arg">arglist</i> <span class="opt">?<span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">args</i> <i class="arg">body</i>?</span>?</span></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>The <b class="package">dbif</b> package provides a higher level wrapper around
the low-level D-Bus commands provided by the dbus package. The package also
handles calls to a number of standard D-Bus interfaces.
The following interfaces are supported:</p>
<ul class="itemized">
<li><p>org.freedesktop.DBus.Peer</p></li>
<li><p>org.freedesktop.DBus.Introspectable</p></li>
<li><p>org.freedesktop.DBus.Properties</p></li>
</ul>
<p>Access to all functions of the <b class="package">dbif</b> package from within
a Tcl program is done using the <b class="cmd">dbif</b> command. The command
supports several subcommands that determine what action is carried out.</p>
<dl class="definitions">
<dt><a name="1"><b class="cmd">dbif</b> <b class="method">connect</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-noqueue</b>?</span> <span class="opt">?<b class="option">-replace</b>?</span> <span class="opt">?<b class="option">-yield</b>?</span> <span class="opt">?<i class="arg">name</i> ...?</span></a></dt>
<dd><p>Connect to a message bus and optionally request the D-Bus server to assign
one or more names to the current application.</p>
<p>The <b class="option">-yield</b> option specifies that the application will release the
requested name when some other application requests the same name and has
indicated that it wants to take over ownership of the name. The application
will be informed by a signal when it loses ownership of the name.</p>
<p>The <b class="option">-replace</b> option indicates that the application wants to take
over the ownership of the name from the application that is currently the
primary owner, if any. This request will only be honoured if the current
owner has indicated that it will release the name on request. See also the
<b class="option">-yield</b> option.</p>
<p>If the requested name is currently in use and the -replace option has not
been specified, or the <b class="option">-replace</b> option was specified but the
current owner is unwilling to give up its ownership, the name request will
normally be queued. Then when the name is released by the current owner it
is assigned to the next requester in the queue and a signal is sent to
inform that requester that it is now the primary owner of the name. The
<b class="option">-noqueue</b> option may be specified to indicate that the name request
should not be queued.</p>
<p>The command returns a list of names that have successfully been acquired.</p></dd>
<dt><a name="2"><b class="cmd">dbif</b> <b class="method">default</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span></a></dt>
<dd><p>Generally an application will perform several <b class="cmd">dbif</b> commands
related to the same message bus and interface. To avoid having to pass the
same values for the <b class="option">-bus</b> and <b class="option">-interface</b> options with all
those commands, their defaults can be setup with the <b class="cmd">dbif</b>
<b class="method">default</b> subcommand.</p>
<p>Valid values for <i class="arg">bustype</i> are <b class="const">session</b> and <b class="const">system</b>.
An interface name has to consist of at least two elements separated by
a period ('.') character. Each element must only contain the characters
&quot;[A-Z][a-z][0-9]_&quot; and must not begin with a digit.</p>
<p>The initial value for <b class="option">-bus</b> is session. The initial value for
<b class="option">-interface</b> is taken from the first name requested for the
application in a <b class="cmd">dbif</b> <b class="method">connect</b> command. If no
name was ever requested with the connect subcommand, it defaults to
&quot;com.tclcode.default&quot;.</p></dd>
<dt><a name="3"><b class="cmd">dbif</b> <b class="method">delete</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i></a></dt>
<dd><p>While there currently is no way to remove individual signals, methods, or
properties from the published interface, this subcommand allows the removal
of a complete node.</p></dd>
<dt><a name="4"><b class="cmd">dbif</b> <b class="method">error</b> <i class="arg">messageID</i> <i class="arg">errormessage</i> <span class="opt">?<i class="arg">errorname</i>?</span></a></dt>
<dd><p>Send a D-Bus error message in response to a D-Bus method call. If the
<i class="arg">errorname</i> argument is not specified, it defaults to
&quot;org.freedesktop.DBus.Error.Failed&quot;.</p></dd>
<dt><a name="5"><b class="cmd">dbif</b> <b class="method">generate</b> <i class="arg">signalID</i> <span class="opt">?<i class="arg">arg</i> ...?</span></a></dt>
<dd><p>Generate a signal as defined by a previous <b class="cmd">dbif</b> 
<b class="method">signal</b> command. If a body was specified with the signal definition,
the provided arguments must match the args definition for the body. Otherwise
they must match the arglist specified during the definition of the signal.</p></dd>
<dt><a name="6"><b class="cmd">dbif</b> <b class="method">get</b> <i class="arg">messageID</i> <i class="arg">name</i></a></dt>
<dd><p>Access additional information about a D-Bus message. Recognized names are
<i class="arg">bus</i>, <i class="arg">member</i>, <i class="arg">interface</i>, <i class="arg">path</i>, <i class="arg">sender</i>,
<i class="arg">destination</i>, <i class="arg">messagetype</i>, <i class="arg">signature</i>, <i class="arg">serial</i>,
<i class="arg">replyserial</i>, <i class="arg">noreply</i>, <i class="arg">autostart</i>, and <i class="arg">errorname</i>.</p></dd>
<dt><a name="7"><b class="cmd">dbif</b> <b class="method">listen</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i> <span class="opt">?<i class="arg">arglist</i>?</span> <span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">body</i></a></dt>
<dd><p>Start listening for the specified signal and execute <i class="arg">body</i> when such a
signal appears on the D-Bus.</p>
<p>The code in <i class="arg">body</i> will be executed in the namespace the
<b class="cmd">dbif</b> <b class="method">listen</b> command was issued from.
The <i class="arg">arglist</i> argument follows the special rules for dbif
argument lists. See <span class="sectref"><a href="#section3">ARGUMENT LISTS</a></span> below for more information.</p></dd>
<dt><a name="8"><b class="cmd">dbif</b> <b class="method">method</b> <span class="opt">?<b class="option">-async</b>?</span> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i> <span class="opt">?<i class="arg">inputargs</i> <span class="opt">?<i class="arg">outputargs</i>?</span>?</span> <span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">body</i></a></dt>
<dd><p>Define a method that may be accessed through the D-Bus and execute <i class="arg">body</i>
when the method is invoked. The <i class="arg">inputargs</i> argument specifies which
arguments must be provided by the caller. The <i class="arg">outputargs</i> argument
indicates the type of result the method returns.</p>
<p>If the body code doesn't generate a response message using the
<b class="cmd">dbif</b> <b class="method">return</b> or <b class="cmd">dbif</b> <b class="method">error</b>
subcommands, the return value resulting from executing the body will be
returned to the caller in a D-Bus return message. If an uncaught error
occurs or the result of body doesn't match <i class="arg">outputargs</i>, an error
message will be returned to the caller instead.</p>
<p>When the <b class="option">-async</b> option is specified, the result of the method body
will not automatically be returned to the caller. In this case the body code
must arrange for a result to be sent back to the caller using the
<b class="method">return</b>, or <b class="method">error</b> subcommands.</p>
<p>An additional variable <b class="variable">msgid</b> will be passed to the method body. This
variable contains a messageID that may be used in combination with the
<b class="method">get</b>, <b class="method">return</b>, or <b class="method">error</b> subcommands. The messageID
remains valid for a period of time (default 25 seconds), or until a response
has been returned to the caller, whichever happens first.</p>
<p>The code in <i class="arg">body</i> will be executed in the namespace the
<b class="cmd">dbif</b> <b class="method">method</b> command was issued from.
The <i class="arg">inputargs</i> and <i class="arg">outputargs</i> arguments follow the special rules
for dbif argument lists.
See <span class="sectref"><a href="#section3">ARGUMENT LISTS</a></span> below for more information.</p></dd>
<dt><a name="9"><b class="cmd">dbif</b> <b class="method">property</b> <span class="opt">?<b class="option">-access</b> <i class="arg">mode</i>?</span> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i>?:<i class="arg">signature</i>? <i class="arg">variable</i> <span class="opt">?<span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">body</i>?</span></a></dt>
<dd><p>Define a property that may be accessed through the D-Bus using methods defined 
by the org.freedesktop.DBus.Properties standard interface. The <i class="arg">variable</i>
argument defines the global variable holding the value of the property.</p>
<p>The <b class="option">-access</b> option specifies whether the property can be viewed
and/or modified through the D-Bus. Valid access modes are <b class="const">read</b>,
<b class="const">write</b>, and <b class="const">readwrite</b>. If no access mode is specified, it
defaults to readwrite.</p>
<p>The code in the optional <i class="arg">body</i> argument will be executed when the
property is modified through the D-Bus. During the execution of <i class="arg">body</i>
the global variable will still have its original value, if any. The new
value for the property is passed to the script as an argument with the same
name as the property. If execution of <i class="arg">body</i> results in an error, the
global variable will not be modified. This allows restrictions to be imposed
on the value for the property.</p>
<p>The code in <i class="arg">body</i> will be executed in the namespace the
<b class="cmd">dbif</b> <b class="method">property</b> command was issued from or, if a slave
interpreter was specified, in the current namespace of that slave interpreter
at definition time..</p></dd>
<dt><a name="10"><b class="cmd">dbif</b> <b class="method">return</b> <i class="arg">messageID</i> <i class="arg">returnvalue</i></a></dt>
<dd><p>Send a D-Bus return message in response to a D-Bus method call.</p></dd>
<dt><a name="11"><b class="cmd">dbif</b> <b class="method">signal</b> <span class="opt">?<b class="option">-bus</b> <i class="arg">bustype</i>?</span> <span class="opt">?<b class="option">-interface</b> <i class="arg">interface</i>?</span> <i class="arg">path</i> <i class="arg">name</i> <span class="opt">?<i class="arg">arglist</i> <span class="opt">?<span class="opt">?<i class="arg">interp</i>?</span> <i class="arg">args</i> <i class="arg">body</i>?</span>?</span></a></dt>
<dd><p>Define a signal that the application may emit. This command returns
a signal identifier that may be used with the <b class="cmd">dbif</b>
<b class="method">generate</b> subcommand to actually send the signal onto the D-Bus.
If the optional <i class="arg">args</i> and <i class="arg">body</i> arguments are specified, body
will be executed when the signal is transmitted on the D-Bus as a result
of the <b class="cmd">dbif</b> <b class="method">generate</b> subcommand. It is the
responsibility of the body code to produce a return value that matches
the specified arglist.</p>
<p>The code in <i class="arg">body</i> will be executed in the namespace the
<b class="cmd">dbif</b> <b class="method">signal</b> command was issued from.
The <i class="arg">arglist</i> argument follows the special rules for dbif
argument lists. See <span class="sectref"><a href="#section3">ARGUMENT LISTS</a></span> below for more information.</p></dd>
</dl>
</div>
<div id="section2" class="section"><h2><a name="section2">VALID NAMES</a></h2>
<p>The dbif package enforces some limitations on names used with the
<b class="cmd">dbif</b> subcommands. All names must only use the characters
&quot;[A-Z][a-z][0-9]_&quot;. This limitation applies to method
names, property names, signal names, and argument names. Out of this group,
only argument names may begin with a digit.</p>
<p>Interface names and error names must consist of at least two elements
separated by a period ('.') character. Each element must only contain the
characters &quot;[A-Z][a-z][0-9]_&quot; and must not begin with a
digit.</p>
<p>D-Bus names for applications must follow the same rules as interface names,
except that also dash ('-') characters are allowed. Unique D-Bus names begin
with a colon (':'). The elements of unique D-Bus names are allowed to begin
with a digit.</p>
<p>Paths must start with a slash ('/') and must consist of elements separated
by slash characters. Each element must only contain the characters
&quot;[A-Z][a-z][0-9]_&quot;. Empty elements are not allowed.</p>
</div>
<div id="section3" class="section"><h2><a name="section3">ARGUMENT LISTS</a></h2>
<p>Due to the fact that the D-Bus specification works with typed arguments, a
slightly modified method for specifying argument lists has been adopted for
the dbif package. The normal Tcl argument list as used with the
<b class="cmd">proc</b> and <b class="cmd">apply</b> commands may still be used. In that case all
arguments will be of the string type. To specify a different type, the
variable name must be followed by a colon and the D-Bus signature
specification for that argument. Example: to define the count argument as
a 32-bit integer, it should be specified as count:i.</p>
<p>The following argument types are available:</p>
<dl class="definitions">
<dt>s</dt>
<dd><p>A UTF-8 encoded, nul-terminated Unicode string.</p></dd>
<dt>b</dt>
<dd><p>A boolean, FALSE (0), or TRUE (1).</p></dd>
<dt>y</dt>
<dd><p>A byte (8-bit unsigned integer).</p></dd>
<dt>n</dt>
<dd><p>A 16-bit signed integer.</p></dd>
<dt>q</dt>
<dd><p>A 16-bit unsigned integer.</p></dd>
<dt>i</dt>
<dd><p>A 32-bit signed integer.</p></dd>
<dt>u</dt>
<dd><p>A 32-bit unsigned integer.</p></dd>
<dt>x</dt>
<dd><p>A 64-bit signed integer.</p></dd>
<dt>t</dt>
<dd><p>A 64-bit unsigned integer.</p></dd>
<dt>d</dt>
<dd><p>An 8-byte double in IEEE 754 format.</p></dd>
<dt>g</dt>
<dd><p>A type signature.</p></dd>
<dt>o</dt>
<dd><p>An object path.</p></dd>
<dt>a#</dt>
<dd><p>A D-Bus array type, which is similar to a Tcl list. The # specifies
the type of the array elements. This can be any type, including another
array, a struct or a dict entry.</p></dd>
<dt>v</dt>
<dd><p>A D-Bus variant type. Specifying this type will cause the code to
automatically determine the type of the provided value (by looking at the
internal representation).</p></dd>
<dt>(...)</dt>
<dd><p>A struct. The string inside the parentheses defines the types of
the arguments within the struct, which may consist of a combination of any
of the existing types.</p></dd>
<dt>{##}</dt>
<dd><p>A dict entry. Dict entries may only occur as array elements. The
first # specifies the type of the dict key. This must be a basic type
(one of 'sbynqiuxtdgo'). The second # specifies the type of the dict value.
This can again be any existing type.</p></dd>
</dl>
<p>Argument lists may contain optional arguments. The use of optional arguments
will result in multiple prototypes being reported for the object when
introspected. The special meaning of the <b class="const">args</b> argument does not
translate well in the D-Bus concept. For that reason using <i class="arg">args</i> as the
last argument of an argument list should be avoided.</p>
</div>
<div id="copyright" class="section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2008-2013 Schelte Bron</p>
</div>
</div></body></html>
